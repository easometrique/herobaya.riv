<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Baya Rive — Hard Test</title>
  <style>
    :root { --bg:#f5f5f5; --ink:#111 }
    html,body{height:100%;margin:0;background:var(--bg);font-family:system-ui,Inter,Arial,sans-serif;color:var(--ink)}
    .wrap{display:flex;align-items:flex-start;justify-content:center;padding:32px}
    .card{background:#fff;border-radius:14px;box-shadow:0 16px 50px rgba(0,0,0,.12);padding:12px}
    /* Force the canvas to have a real width so clientWidth != 0 */
    canvas{display:block;width:min(1200px, 94vw); height:auto; border-radius:12px; background:#fff}
    .status{position:fixed;left:12px;bottom:12px;background:#fff;border:1px solid #eee;padding:10px 12px;border-radius:10px;box-shadow:0 8px 30px rgba(0,0,0,.12);max-width:92vw;font:12px/1.4 ui-monospace,Menlo,Consolas,monospace}
    .err{color:#b00020}
    .ok{color:#0a6}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <canvas id="stage"></canvas>
    </div>
  </div>

  <div class="status" id="status">Starting…</div>

  <script src="https://unpkg.com/@rive-app/canvas@2.11.0"></script>
  <script>
    // ---- Your file & names (case-sensitive) ----
    const RIV_URL  = 'https://easometrique.github.io/herobaya.riv/baya_hero_project.riv?v=' + Date.now();
    const ARTBOARD = 'Desktop - 1';   // from your screenshot
    const SM_NAME  = 'HeroMachine';   // your state machine
    const FALLBACK_ANIMS = ['Idle'];  // change to any known animation if Idle doesn't exist
    // --------------------------------------------

    const statusEl = document.getElementById('status');
    const canvas   = document.getElementById('stage');
    let app;

    function setStatus(html, cls='') {
      statusEl.className = 'status ' + cls;
      statusEl.innerHTML = html;
      console.log('[status]', statusEl.textContent);
    }

    function sizeCanvas() {
      const dpr  = window.devicePixelRatio || 1;
      const cssW = canvas.clientWidth;               // now guaranteed > 0
      const cssH = Math.round(cssW * (800/1200));    // 1200x800 aspect; tweak if needed
      canvas.style.height = cssH + 'px';
      canvas.width  = Math.round(cssW * dpr);
      canvas.height = Math.round(cssH * dpr);
      if (app) app.resizeDrawingSurfaceToCanvas();
    }

    async function head(url) {
      try {
        const r = await fetch(url, { method:'HEAD', cache:'no-store' });
        if (!r.ok) throw new Error('HTTP ' + r.status);
        return r.status;
      } catch (err) {
        throw err;
      }
    }

    function startWithStateMachine() {
      setStatus('Init with state machine: <b>'+SM_NAME+'</b>');
      app = new rive.Rive({
        src: RIV_URL,
        canvas,
        artboard: ARTBOARD,
        stateMachines: SM_NAME,
        autoplay: true,
        fit: rive.Fit.CONTAIN,
        alignment: rive.Alignment.center,
        onLoad: () => {
          sizeCanvas();
          const inputs = app.stateMachineInputs(SM_NAME) || [];
          console.log('SM inputs:', inputs.map(i => `${i.name}`));
          if (!inputs.length) {
            setStatus('Loaded SM but found <b>0 inputs</b>. Trying fallback animation…');
            app.cleanup();
            startWithAnimation();
          } else {
            setStatus('Loaded SM "'+SM_NAME+'" — inputs: '+inputs.map(i=>i.name).join(', '), 'ok');
          }
        }
      });
    }

    function startWithAnimation() {
      setStatus('Init with animation: <b>'+ (FALLBACK_ANIMS.join(', ') || '(none)') +'</b>');
      app = new rive.Rive({
        src: RIV_URL,
        canvas,
        artboard: ARTBOARD,
        animations: FALLBACK_ANIMS,
        autoplay: true,
        fit: rive.Fit.CONTAIN,
        alignment: rive.Alignment.center,
        onLoad: () => {
          sizeCanvas();
          setStatus('Loaded animation(s): '+FALLBACK_ANIMS.join(', '), 'ok');
        }
      });
    }

    (async function main(){
      // 1) Make sure the .riv is reachable
      try {
        const code = await head(RIV_URL);
        setStatus('Asset OK ('+code+'): '+RIV_URL.replace(/\?.*$/,'') , 'ok');
      } catch (err) {
        setStatus('Failed to reach .riv ('+err.message+'). Check URL/filename.', 'err');
        return;
      }

      // 2) Ensure canvas has size
      sizeCanvas();
      window.addEventListener('resize', sizeCanvas);

      // 3) Try state machine, then fallback to animation
      startWithStateMachine();
      // If screen still blank after a moment (e.g., wrong SM name), force fallback
      setTimeout(() => {
        if (!app) return;
        try { app.cleanup && app.cleanup(); } catch(e){}
        startWithAnimation();
      }, 1200);
    })();
  </script>
</body>
</html>
